<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Instagram DM – Final</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background:#fff; min-height:200vh; overflow-x:hidden; }

    .header-container { position:fixed; top:0; left:0; right:0; background:#fff; z-index:1000; transition:all .3s; }
    .top-navbar { background:#fff; padding:16px 20px 19px; display:flex; justify-content:center; align-items:center; position:relative; overflow:visible; }
    .messages-icon { position:absolute; left:20px; width:24px; height:24px; top:50%; transform:translateY(-45%); fill:#749cbf; }
    .add-button { position:absolute; right:20px; cursor:pointer; }
    .add-button i { color:#666; font-size:20px; }
    .top-navbar h1 { font-size:18px; font-weight:500; color:#333; opacity:0; transition:opacity .3s; position:absolute; }
    .top-navbar h1.visible { opacity:1; }

    .stories-collapsed {
      position:absolute; left:50%; transform:translateX(-50%) translateY(6px);
      display:inline-flex; align-items:center; gap:0; transition:all .2s ease;
      opacity:1; pointer-events:auto; z-index:5; cursor:pointer;
    }
    .stories-collapsed.moved { opacity:0; pointer-events:none; }
    .story-item-collapsed { min-width:40px; margin:0 -4px; position:relative; }
    .story-item-collapsed:first-child { margin-left:0; }
    .story-item-collapsed:last-child  { margin-right:0; }

    .story-ring-collapsed {
      width:40px; height:40px; border-radius:50%; padding:1.5px;
      background:linear-gradient(45deg,rgb(240,148,51),rgb(230,104,60),rgb(220,39,67),rgb(204,35,102),rgb(188,24,136));
      display:flex; align-items:center; justify-content:center; position:relative;
    }
    .story-ring-collapsed::after {
      content:''; position:absolute; top:50%; right:-1.5px; width:3px; height:30px;
      background:#fff; border-radius:50%; display:none; transform:translateY(-50%);
    }
    .story-item-collapsed:not(:last-child) .story-ring-collapsed::after { display:block; }

    .story-ring-inner-collapsed { width:100%; height:100%; border-radius:50%; background:#fff; padding:1.5px;
      display:flex; align-items:center; justify-content:center; z-index:2; }
    .story-avatar-collapsed { width:100%; height:100%; border-radius:50%; object-fit:cover; }
    .story-avatar-text-collapsed { width:100%; height:100%; border-radius:50%; background:#ff8c42;
      display:flex; align-items:center; justify-content:center; font-size:16px; font-weight:600; color:#fff; }

    .stories-expanded { background:#fff; padding:16px 0; overflow-x:auto; white-space:nowrap;
      max-height:0; opacity:0; transform:scale(.95); transition:all .2s; }
    .stories-expanded.visible { max-height:150px; opacity:1; transform:scale(1); }
    .stories-wrapper { display:flex; gap:16px; padding:0 16px; }
    .story-item { display:flex; flex-direction:column; align-items:center; cursor:pointer; min-width:64px; }
    .story-ring { width:64px; height:64px; border-radius:50%; padding:1.5px;
      background:linear-gradient(45deg,rgb(240,148,51),rgb(230,104,60),rgb(220,39,67),rgb(204,35,102),rgb(188,24,136));
      display:flex; align-items:center; justify-content:center; }
    .story-ring.multi-story {
      background:conic-gradient(from 0deg,rgb(240,148,51) 0deg,rgb(230,104,60) 45deg,rgb(220,39,67) 90deg,
        rgb(204,35,102) 135deg,rgb(188,24,136) 175deg,#dbdbdb 177deg,#dbdbdb 183deg,
        rgb(240,148,51) 185deg,rgb(230,104,60) 230deg,rgb(220,39,67) 270deg,
        rgb(204,35,102) 315deg,rgb(188,24,136) 355deg,#dbdbdb 357deg,#dbdbdb 360deg);
    }
    .story-ring-inner { width:100%; height:100%; border-radius:50%; background:#fff; padding:1.5px;
      display:flex; align-items:center; justify-content:center; }
    .story-avatar { width:100%; height:100%; border-radius:50%; object-fit:cover; }
    .story-avatar-text { width:100%; height:100%; border-radius:50%; background:#ff8c42;
      display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:600; color:#fff; }
    .story-label { margin-top:8px; font-size:12px; color:#262626; text-align:center;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:64px; }

    .nav-container { background:#fff; }
    .nav-bar { display:flex; justify-content:space-around; align-items:center; padding:10px 0;
      max-width:400px; margin:0 auto; position:relative; }
    .nav-item { flex:1; display:flex; justify-content:center; align-items:center; cursor:pointer; padding:8px; }
    .nav-item i { font-size:20px; color:#666; transition:color .3s; }
    .nav-item:hover i { color:#333; }
    .nav-item.active i { color:#749cbf; }
    .bottom-border { height:3px; background:#e0e0e0; position:relative; }
    .active-indicator { position:absolute; height:100%; width:33.333%; background:#749cbf;
      transition:left .3s; left:0; }

    .content-spacer { transition:height .2s; }
    .content-spacer.collapsed { height:80px; }
    .content-spacer.expanded { height:180px; }

    .message-item { display:flex; align-items:center; padding:10px 16px; background:#fff;
      border-bottom:1px solid #f0f0f0; cursor:pointer; }
    .message-item:hover { background:#f8f8f8; }
    .message-avatar { width:56px; height:56px; border-radius:50%; background:#ff9d5c;
      display:flex; align-items:center; justify-content:center; font-size:20px; font-weight:600;
      color:#fff; margin-right:12px; flex-shrink:0; }
    .message-content { flex:1; min-width:0; }
    .message-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:2px; }
    .message-name { font-size:17px; font-weight:500; color:#262626; }
    .message-date { font-size:14px; color:#8e8e8e; }
    .message-preview { font-size:16px; color:#8e8e8e; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    /* STORY VIEWER – Gradient at 0px, Content at 7px */
    .story-viewer-overlay {
      position:fixed; top:0; left:0; right:0; bottom:70px;
      background:#000; z-index:2000;
      display:flex; align-items:center; justify-content:center;
      overflow:hidden; transition:opacity .3s;
      border-radius: 0 !important;
    }
    .story-viewer-content {
      width:100%; height:100%; position:relative;
      pointer-events:none; user-select:none; -webkit-user-drag:none;
    }
    .story-viewer-background {
      width:100%; height: 100%; position: static; top: 0;
      background: #000; display:flex; align-items:center; justify-content:center;
      border-radius: 0; overflow:hidden;
    }
    .story-viewer-header {
      position:absolute; top: 0; left:0; right:0;
      padding: 0 12px 16px;
      background:linear-gradient(180deg,rgba(0,0,0,.4),rgba(0,0,0,.2) 50%,transparent);
      z-index:10;
    }
    .story-header-content {
      padding-top: 7px;
    }
    .story-progress-container { display:flex; gap:4px; margin-bottom:12px; }
    .story-progress-bar { flex:1; height:2px; background:rgba(255,255,255,.3); border-radius:2px; overflow:hidden; }
    .story-progress-fill { height:100%; background:#fff; width:100%; }
    .story-user-info { display:flex; align-items:center; justify-content:space-between; }
    .story-user-left { display:flex; align-items:center; gap:8px; }
    .story-user-avatar { width:32px; height:32px; border-radius:50%; border:2px solid #fff;
      background:#ff8c42; display:flex; align-items:center; justify-content:center;
      font-size:14px; font-weight:600; color:#fff; }
    .story-user-details { display:flex; flex-direction:column; }
    .story-username { font-size:14px; font-weight:600; color:#fff; }
    .story-time { font-size:12px; color:rgba(255,255,255,.7); }
    .story-actions { display:flex; align-items:center; gap:8px; }
    .story-action-btn {
      background:none; border:none; color:#fff; cursor:pointer;
      font-size:20px; padding:4px; pointer-events:auto !important;
    }
    .story-action-dots {
      color: #fff;
      font-size: 20px;
      font-weight: 300;
      letter-spacing: 1px;
      margin-left: 8px;
      pointer-events: none;
    }

    .story-viewer-footer { position:absolute; bottom:0; left:0; right:0; padding:20px;
      background:linear-gradient(0deg,rgba(0,0,0,.3),rgba(0,0,0,.1) 50%,transparent);
      z-index:10; pointer-events:none; }
    .story-caption { font-size:18px; font-weight:500; color:#fff; text-align:left; line-height:1.4; }

    /* REPLY BAR – No border, pill shape */
    .story-reply-bar {
      position:fixed; left:0; right:0; bottom:0; height:70px;
      background:#000; display:flex; align-items:center; justify-content:center;
      z-index:2100; padding:0 20px; backdrop-filter:blur(10px);
    }
    .story-reply-box {
      width:100%; max-width:500px; padding:12px 20px;
      background:#171717;
      border: none;
      border-radius:50px;
      color:rgba(255,255,255,.5); 
      font-size:15px;
      text-align:left; 
      pointer-events:none; 
      user-select:none;
    }
    .story-reply-bar.hidden { display:none; }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
  const { useState, useEffect } = React;

  function NavigationBar() {
    const [activeIndex, setActiveIndex] = useState(0);
    const [isScrolled, setIsScrolled] = useState(false);
    const [lastScrollY, setLastScrollY] = useState(0);
    const [showStoryViewer, setShowStoryViewer] = useState(false);
    const [touchStartY, setTouchStartY] = useState(null);
    const [currentStory, setCurrentStory] = useState(null);

    const formatTime = () => {
      const now = new Date();
      const hours = now.getHours();
      const mins = now.getMinutes().toString().padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      const displayHours = hours % 12 || 12;
      return `Today at ${displayHours}:${mins} ${ampm}`;
    };

    useEffect(() => {
      const onScroll = () => {
        const cur = window.scrollY;
        if (cur > lastScrollY && cur > 5) setIsScrolled(true);
        else if (cur < lastScrollY && cur < 5) setIsScrolled(false);
        setLastScrollY(cur);
      };
      window.addEventListener('scroll', onScroll);
      return () => window.removeEventListener('scroll', onScroll);
    }, [lastScrollY]);

    const handleNavClick = i => setActiveIndex(i);
    const handleCollapsedStoryClick = () => setIsScrolled(true);

    const openStory = s => {
      setCurrentStory(s);
      setShowStoryViewer(true);
    };

    const handleMyStoryClick = () => openStory({
      username:'My story', time: formatTime(), avatar:'M', progressBars:1,
      background:'#000000', caption:''
    });

    const handleVaViaStoryClick = () => openStory({
      username:'VaVia', time: formatTime(),
      avatar:'https://i.ibb.co/C5b875C6/Screenshot-20250904-050841.jpg',
      progressBars:2,
      background:'linear-gradient(135deg,#ff9a56,#ff6a00,#ff4500)', caption:'Guess the Animal'
    });

    const touchStart = e => {
      setTouchStartY(e.touches[0].clientY);
    };

    const touchMove = e => {
      if (!touchStartY) return;
      const currentY = e.touches[0].clientY;
      const deltaY = currentY - touchStartY;
      if (deltaY > 20) {
        setShowStoryViewer(false);
        setTouchStartY(null);
      }
    };

    const touchEnd = () => {
      setTouchStartY(null);
    };

    const closeStory = () => setShowStoryViewer(false);

    return (
      <>
        <div className="header-container">
          <div className="top-navbar">
            <svg className="messages-icon" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" fill="#749cbf"/></svg>
            <h1 className={isScrolled ? 'visible' : ''}>Messages</h1>

            <div className={`stories-collapsed ${isScrolled ? 'moved' : ''}`} onClick={handleCollapsedStoryClick}>
              <div className="story-item-collapsed">
                <div className="story-ring-collapsed">
                  <div className="story-ring-inner-collapsed">
                    <div className="story-avatar-text-collapsed">M</div>
                  </div>
                </div>
              </div>
              <div className="story-item-collapsed">
                <div className="story-ring-collapsed">
                  <div className="story-ring-inner-collapsed">
                    <img src="https://i.ibb.co/C5b875C6/Screenshot-20250904-050841.jpg" alt="VaVia" className="story-avatar-collapsed"/>
                  </div>
                </div>
              </div>
            </div>

            <div className="add-button"><i className="fas fa-search"></i></div>
          </div>

          <div className={`stories-expanded ${isScrolled ? 'visible' : ''}`}>
            <div className="stories-wrapper">
              <div className="story-item" onClick={handleMyStoryClick}>
                <div className="story-ring"><div className="story-ring-inner"><div className="story-avatar-text">M</div></div></div>
                <div className="story-label">My story</div>
              </div>
              <div className="story-item" onClick={handleVaViaStoryClick}>
                <div className="story-ring multi-story"><div className="story-ring-inner"><img src="https://i.ibb.co/C5b875C6/Screenshot-20250904-050841.jpg" alt="VaVia" className="story-avatar"/></div></div>
                <div className="story-label">VaVia</div>
              </div>
            </div>
          </div>

          <div className="nav-container">
            <div className="nav-bar">
              <div className={`nav-item ${activeIndex===0?'active':''}`} onClick={()=>handleNavClick(0)}><i className="far fa-clock"></i></div>
              <div className={`nav-item ${activeIndex===1?'active':''}`} onClick={()=>handleNavClick(1)}><i className="fas fa-user-friends"></i></div>
              <div className={`nav-item ${activeIndex===2?'active':''}`} onClick={()=>handleNavClick(2)}><i className="fas fa-list"></i></div>
            </div>
            <div className="bottom-border"><div className="active-indicator" style={{left:`${activeIndex*33.333}%`}}></div></div>

            <div className="message-item">
              <div className="message-avatar">DS</div>
              <div className="message-content"><div className="message-header"><div className="message-name">Daddy Steve</div><div className="message-date">Oct 27</div></div><div className="message-preview">How are you doing</div></div>
            </div>
            <div className="message-item">
              <div className="message-avatar"><img src="https://i.ibb.co/C5b875C6/Screenshot-20250904-050841.jpg" alt="VaVia" style={{width:'100%',height:'100%',borderRadius:'50%',objectFit:'cover'}}/></div>
              <div className="message-content"><div className="message-header"><div className="message-name">VaVia</div><div className="message-date">Oct 25</div></div><div className="message-preview">See you tomorrow!</div></div>
            </div>
          </div>
        </div>

        <div className={`content-spacer ${isScrolled?'expanded':'collapsed'}`}></div>

        {showStoryViewer && currentStory && (
          <div 
            className="story-viewer-overlay"
            style={{ transition: 'opacity 0.3s' }}
            onTouchStart={touchStart}
            onTouchMove={touchMove}
            onTouchEnd={touchEnd}
          >
            <div className="story-viewer-content">
              <div className="story-viewer-background" style={{background:currentStory.background}}></div>

              <div className="story-viewer-header">
                <div className="story-header-content">
                  <div className="story-progress-container">
                    {[...Array(currentStory.progressBars)].map((_,i)=>
                      <div key={i} className="story-progress-bar"><div className="story-progress-fill"></div></div>
                    )}
                  </div>
                  <div className="story-user-info">
                    <div className="story-user-left">
                      <div className="story-user-avatar">
                        {typeof currentStory.avatar==='string' && currentStory.avatar.startsWith('http')?
                          <img src={currentStory.avatar} alt={currentStory.username} style={{width:'100%',height:'100%',borderRadius:'50%',objectFit:'cover'}}/>:
                          currentStory.avatar}
                      </div>
                      <div className="story-user-details">
                        <div className="story-username">{currentStory.username}</div>
                        <div className="story-time">{currentStory.time}</div>
                      </div>
                    </div>
                    <div className="story-actions">
                      <button className="story-action-btn" onClick={closeStory}>
                        <i className="fas fa-times"></i>
                      </button>
                      <span className="story-action-dots">...</span>
                    </div>
                  </div>
                </div>
              </div>

              {currentStory.caption && (
                <div className="story-viewer-footer">
                  <div className="story-caption">{currentStory.caption}</div>
                </div>
              )}
            </div>
          </div>
        )}

        <div className={`story-reply-bar ${showStoryViewer?'':'hidden'}`}>
          <div className="story-reply-box">Reply privately...</div>
        </div>
      </>
    );
  }

  const root = ReactDOM.createRoot(document.getElementById('root'));
  root.render(<NavigationBar />);
</script>
</body>
</html>
