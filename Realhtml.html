<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Instagram Messages – Fixed Stories & Static Reply</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    
    /* Force hide scrollbar on HTML and BODY */
    html {
      overflow: hidden;
      height: 100%;
    }
    
    body { 
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; 
      background:#fff;
      height: 100%;
      overflow: hidden;
      position: relative;
    }
    
    /* Create scrollable wrapper that hides scrollbar */
    #root {
      height: 100vh;
      overflow-y: scroll;
      overflow-x: hidden;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    
    #root::-webkit-scrollbar {
      display: none;
      width: 0 !important;
      height: 0 !important;
    }
    
    .page-wrapper {
      min-height: 100vh;
    }

    /* ================== HEADER (FIXED) ================== */
    /* This section remains fixed on top */
    .header-container { position:fixed; top:0; left:0; right:0; background:#fff; z-index:1000; transition:all .3s; }
    .top-navbar { background:#fff; padding:16px 20px 19px; display:flex; justify-content:center; align-items:center; position:relative; overflow:visible; }
    .messages-icon { position:absolute; left:20px; width:24px; height:24px; top:50%; transform:translateY(-45%); fill:#749cbf; }
    .add-button { position:absolute; right:20px; cursor:pointer; }
    .add-button i { color:#666; font-size:20px; }
    /* This style makes the title visible */
    .top-navbar h1 { font-size:18px; font-weight:500; color:#333; opacity:0; transition:opacity .3s; position:absolute; }
    .top-navbar h1.visible { opacity:1; }

    /* ---------- Collapsed Stories (FIXED) ---------- */
    .stories-collapsed {
      position:absolute; left:50%; transform:translateX(-50%) translateY(6px);
      display:inline-flex; align-items:center; gap:0; transition:all .2s ease;
      /* Initial state: Hidden (opacity 0, pointer-events none) */
      opacity:0; pointer-events:none; z-index:5; cursor:pointer;
    }
    .stories-collapsed.moved { 
      /* New state: Visible when scrolled (opacity 1, pointer-events auto) */
      opacity:1; pointer-events:auto; 
    }
    .story-item-collapsed { min-width:40px; margin:0 -4px; position:relative; }
    .story-item-collapsed:first-child { margin-left:0; }
    .story-item-collapsed:last-child  { margin-right:0; }

    .story-ring-collapsed {
      width:40px; height:40px; border-radius:50%; padding:1.5px;
      background:linear-gradient(45deg,rgb(240,148,51),rgb(230,104,60),rgb(220,39,67),rgb(204,35,102),rgb(188,24,136));
      display:flex; align-items:center; justify-content:center; position:relative;
    }
    .story-ring-collapsed::after {
      content:''; position:absolute; top:50%; right:-1.5px; width:3px; height:30px;
      background:#fff; border-radius:50%; display:none; transform:translateY(-50%);
    }
    .story-item-collapsed:not(:last-child) .story-ring-collapsed::after { display:block; }

    .story-ring-inner-collapsed { width:100%; height:100%; border-radius:50%; background:#fff; padding:1.5px;
      display:flex; align-items:center; justify-content:center; z-index:2; }
    .story-avatar-collapsed { width:100%; height:100%; border-radius:50%; object-fit:cover; }
    .story-avatar-text-collapsed { width:100%; height:100%; border-radius:50%; background:#ff8c42;
      display:flex; align-items:center; justify-content:center; font-size:16px; font-weight:600; color:#fff; }

    /* ---------- Expanded Stories ---------- */
    .stories-expanded { 
      background:#fff; 
      padding:16px 0; 
      overflow-x:auto; 
      white-space:nowrap;
      max-height:0; 
      opacity:0; 
      transform:scale(.95); 
      transition:all .2s;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    .stories-expanded::-webkit-scrollbar {
      display: none;
    }
    .stories-expanded.visible { max-height:150px; opacity:1; transform:scale(1); }
    .stories-wrapper { display:flex; gap:16px; padding:0 16px; }
    .story-item { display:flex; flex-direction:column; align-items:center; cursor:pointer; min-width:64px; }
    .story-ring { width:64px; height:64px; border-radius:50%; padding:1.5px;
      background:linear-gradient(45deg,rgb(240,148,51),rgb(230,104,60),rgb(220,39,67),rgb(204,35,102),rgb(188,24,136));
      display:flex; align-items:center; justify-content:center; }
    .story-ring.multi-story {
      background:conic-gradient(from 0deg,rgb(240,148,51) 0deg,rgb(230,104,60) 45deg,rgb(220,39,67) 90deg,
        rgb(204,35,102) 135deg,rgb(188,24,136) 175deg,#dbdbdb 177deg,#dbdbdb 183deg,
        rgb(240,148,51) 185deg,rgb(230,104,60) 230deg,rgb(220,39,67) 270deg,
        rgb(204,35,102) 315deg,rgb(188,24,136) 355deg,#dbdbdb 357deg,#dbdbdb 360deg);
    }
    .story-ring-inner { width:100%; height:100%; border-radius:50%; background:#fff; padding:1.5px;
      display:flex; align-items:center; justify-content:center; }
    .story-avatar { width:100%; height:100%; border-radius:50%; object-fit:cover; }
    .story-avatar-text { width:100%; height:100%; border-radius:50%; background:#ff8c42;
      display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:600; color:#fff; }
    .story-label { margin-top:8px; font-size:12px; color:#262626; text-align:center;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:64px; }

    /* ---------- Nav & Messages ---------- */
    .nav-container { background:#fff; }
    .nav-bar { display:flex; justify-content:space-around; align-items:center; padding:10px 0;
      max-width:400px; margin:0 auto; position:relative; }
      
    .nav-item { flex:1; display:flex; justify-content:center; align-items:center; cursor:pointer; padding:8px; }
    .nav-item i { font-size:20px; color:#666; transition:color .3s; }
    .nav-item:hover i { color:#333; }
    .nav-item.active i { color:#749cbf; }
    
    /* FIX: Added margin-bottom to ensure the first message is not overlapped */
    .bottom-border { height:3px; background:#e0e0e0; position:relative; margin-bottom: 2px; }
    .active-indicator { position:absolute; height:100%; width:33.333%; background:#749cbf;
      transition:left .3s; left:0; }

    /* The Spacer holds the place of the fixed header in the scrolling content */
    /* Spacer height adjustments for the new margin-bottom */
    .content-spacer { transition:height .2s; }
    .content-spacer.collapsed { height:82px; /* 80px + 2px margin */ }
    .content-spacer.expanded { height:182px; /* 180px + 2px margin */ }

    .message-item { display:flex; align-items:center; padding:10px 16px; background:#fff;
      border-bottom:1px solid #f0f0f0; cursor:pointer; }
    .message-item:hover { background:#f8f8f8; }
    .message-avatar { width:56px; height:56px; border-radius:50%; background:#ff9d5c;
      display:flex; align-items:center; justify-content:center; font-size:20px; font-weight:600;
      color:#fff; margin-right:12px; flex-shrink:0; }
    .message-avatar img { width:100%; height:100%; border-radius:50%; object-fit:cover; }
    .message-content { flex:1; min-width:0; }
    .message-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:2px; }
    .message-name { font-size:17px; font-weight:500; color:#262626; }
    .message-date { font-size:14px; color:#8e8e8e; }
    .message-preview { font-size:16px; color:#8e8e8e; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    /* ---------- Blank Pop-up Screen (FIXED POSITION – NO DRAG MOVEMENT) ---------- */
    .story-viewer-overlay {
      position:fixed; top:0; left:0; right:0; bottom:70px;
      background:#000; z-index:2000; display:flex; align-items:center; justify-content:center;
      overflow:hidden;
      touch-action: none;
      overscroll-behavior: none;
    }
    .story-viewer-content { 
      width:100%; height:100%; position:relative; background:#000; 
    }

    /* ---------- Static Reply Bar – Instagram DM Style (FIXED) ---------- */
    .story-reply-bar {
      position:fixed; left:0; right:0; bottom:0; height:70px; background:#000;
      display:flex; align-items:center; justify-content:center; z-index:2100;
      padding:0 16px; 
    }
    .story-reply-box {
      width:100%; max-width:500px; padding:12px 20px; background:#171717;
      border:1px solid transparent; border-radius:50px;
      color:rgba(255,255,255,.5); font-size:15px; 
      text-align:left; padding-left:20px;
      pointer-events:none; user-select:none;
      line-height:1.4;
    }
    .story-reply-bar.hidden { display:none; }
  </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
  const { useState, useEffect, useRef } = React;

  const MessageData = [
    { name: "Daddy Steve", initial: "DS", date: "Oct 27", preview: "How are you doing", image: null },
    { name: "VaVia", initial: "V", date: "Oct 25", preview: "See you tomorrow!", image: "https://i.ibb.co/C5b875C6/Screenshot-20250904-050841.jpg" },
    // --- More Conversation List Added Here ---
    { name: "Alice", initial: "A", date: "Oct 24", preview: "Check out this link I found...", image: null },
    { name: "Bob's Diner", initial: "B", date: "Oct 23", preview: "Your reservation is confirmed.", image: null },
    { name: "Charlie", initial: "C", date: "Oct 22", preview: "Got the new project specs.", image: null },
    { name: "Diana Prince", initial: "DP", date: "Oct 21", preview: "Where are we meeting?", image: "https://picsum.photos/id/237/200/300" },
    { name: "Ethan Hunt", initial: "EH", date: "Oct 20", preview: "Mission accepted.", image: null },
    { name: "Fiona Apple", initial: "FA", date: "Oct 19", preview: "Did you hear the new song?", image: null },
    { name: "George Michael", initial: "GM", date: "Oct 18", preview: "Happy Holidays!", image: "https://picsum.photos/id/10/200/300" },
    { name: "Hannah", initial: "H", date: "Oct 17", preview: "Let's catch up next week.", image: null },
    { name: "Ivan Drago", initial: "ID", date: "Oct 16", preview: "I must break you.", image: null },
    { name: "Jasmine", initial: "J", date: "Oct 15", preview: "The cake was delicious!", image: null },
    { name: "Kyle", initial: "K", date: "Oct 14", preview: "Can you send the invoice?", image: "https://picsum.photos/id/60/200/300" },
    { name: "Laura", initial: "L", date: "Oct 13", preview: "See the attached file.", image: null },
    { name: "Marketing Team", initial: "MT", date: "Oct 12", preview: "Next meeting moved to 3 PM.", image: null },
    { name: "New Friend", initial: "NF", date: "Oct 11", preview: "Just saying hi!", image: null },
    { name: "Olivia", initial: "O", date: "Oct 10", preview: "Got the tickets!", image: null },
    { name: "Peter", initial: "P", date: "Oct 9", preview: "Almost there!", image: null },
    { name: "Queen Latifah", initial: "QL", date: "Oct 8", preview: "Call me when you land.", image: "https://picsum.photos/id/40/200/300" },
    { name: "Robert", initial: "R", date: "Oct 7", preview: "Got the email, thanks.", image: null },
    { name: "Stacy", initial: "S", date: "Oct 6", preview: "The meeting went great.", image: null },
  ];

  function MessageItem({ name, initial, date, preview, image }) {
    return (
      <div className="message-item">
        <div className="message-avatar">
          {image ? <img src={image} alt={name} /> : initial}
        </div>
        <div className="message-content">
          <div className="message-header">
            <div className="message-name">{name}</div>
            <div className="message-date">{date}</div>
          </div>
          <div className="message-preview">{preview}</div>
        </div>
      </div>
    );
  }

  function NavigationBar() {
    const [activeIndex, setActiveIndex] = useState(0);
    const [isScrolled, setIsScrolled] = useState(false);
    const [showStoryViewer, setShowStoryViewer] = useState(false);
    const startYRef = useRef(0);
    const currentYRef = useRef(0);
    const hasMoved = useRef(false);

    /* ---------- Scroll handling (The logic for setting isScrolled remains the same) ---------- */
    useEffect(() => {
      const rootElement = document.getElementById('root');
      let lastScrollY = 0;
      
      const onScroll = () => {
        const cur = rootElement.scrollTop;
        
        // This logic determines the header's collapse/expand state
        if (cur > lastScrollY && cur > 5) {
          setIsScrolled(true); // Scrolled down/away from top -> COLLAPSED state
        } else if (cur < lastScrollY && cur < 5) {
          setIsScrolled(false); // Scrolled up to top edge -> EXPANDED state
        }
        
        lastScrollY = cur;
      };
      
      rootElement.addEventListener('scroll', onScroll);
      return () => rootElement.removeEventListener('scroll', onScroll);
    }, []); 

    const handleNavClick = i => setActiveIndex(i);
    
    // Story Click Logic - Toggles to the collapsed state
    const handleCollapsedStoryClick = () => setIsScrolled(true);

    const openStory = () => {
      setShowStoryViewer(true);
    };

    const storyTouchStart = e => {
      startYRef.current = e.touches[0].clientY;
      hasMoved.current = false;
    };

    const storyTouchEnd = e => {
      // Only open if there was no significant movement (it was a tap, not a swipe)
      if (!hasMoved.current) {
        openStory();
      }
      startYRef.current = 0;
      currentYRef.current = 0;
      hasMoved.current = false;
    };

    const storyTouchMove = e => {
      const diff = Math.abs(e.touches[0].clientY - startYRef.current);
      if (diff > 10) {
        hasMoved.current = true;
      }
    };

    const viewerTouchStart = e => {
      startYRef.current = e.touches[0].clientY;
      currentYRef.current = e.touches[0].clientY;
    };

    const viewerTouchMove = e => {
      e.preventDefault(); // Always prevent default to stop pull-to-refresh
      e.stopPropagation();
      
      currentYRef.current = e.touches[0].clientY;
      const diff = currentYRef.current - startYRef.current;
      
      // Dismiss instantly when dragged down just 80px
      if (diff > 80) {
        setShowStoryViewer(false);
        startYRef.current = 0;
        currentYRef.current = 0;
      }
    };

    const viewerTouchEnd = () => {
      startYRef.current = 0;
      currentYRef.current = 0;
    };

    return (
      <div className="page-wrapper">
        {/* ---------- FIXED Header ---------- */}
        <div className="header-container">
          <div className="top-navbar">
            <svg className="messages-icon" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" fill="#749cbf"/></svg>
            
            {/* Messages Title - Visible when NOT scrolled (!isScrolled) */}
            <h1 className={!isScrolled ? 'visible' : ''}>Messages</h1>

            {/* Collapsed Stories – Visible when isScrolled is TRUE */}
            <div className={`stories-collapsed ${isScrolled ? 'moved' : ''}`} onClick={handleCollapsedStoryClick}>
              <div className="story-item-collapsed">
                <div className="story-ring-collapsed">
                  <div className="story-ring-inner-collapsed">
                    <div className="story-avatar-text-collapsed">M</div>
                  </div>
                </div>
              </div>
              <div className="story-item-collapsed">
                <div className="story-ring-collapsed">
                  <div className="story-ring-inner-collapsed">
                    <img src="https://i.ibb.co/C5b875C6/Screenshot-20250904-050841.jpg" alt="VaVia" className="story-avatar-collapsed"/>
                  </div>
                </div>
              </div>
            </div>

            <div className="add-button"><i className="fas fa-search"></i></div>
          </div>

          {/* Expanded Stories – Visible when isScrolled is FALSE */}
          <div className={`stories-expanded ${!isScrolled ? 'visible' : ''}`}>
            <div className="stories-wrapper">
              <div 
                className="story-item" 
                onTouchStart={storyTouchStart}
                onTouchMove={storyTouchMove}
                onTouchEnd={storyTouchEnd}
              >
                <div className="story-ring"><div className="story-ring-inner"><div className="story-avatar-text">M</div></div></div>
                <div className="story-label">My story</div>
              </div>
              <div 
                className="story-item" 
                onTouchStart={storyTouchStart}
                onTouchMove={storyTouchMove}
                onTouchEnd={storyTouchEnd}
              >
                <div className="story-ring multi-story"><div className="story-ring-inner"><img src="https://i.ibb.co/C5b875C6/Screenshot-20250904-050841.jpg" alt="VaVia" className="story-avatar"/></div></div>
                <div className="story-label">VaVia</div>
              </div>
            </div>
          </div>

          {/* Nav Bar (Sticky to the bottom of the fixed header) */}
          <div className="nav-container">
            <div className="nav-bar">
              <div className={`nav-item ${activeIndex===0?'active':''}`} onClick={()=>handleNavClick(0)}><i className="far fa-clock"></i></div>
              <div className={`nav-item ${activeIndex===1?'active':''}`} onClick={()=>handleNavClick(1)}><i className="fas fa-user-friends"></i></div>
              <div className={`nav-item ${activeIndex===2?'active':''}`} onClick={()=>handleNavClick(2)}><i className="fas fa-list"></i></div>
            </div>
            {/* The bottom border now includes margin-bottom of 2px for separation */}
            <div className="bottom-border"><div className="active-indicator" style={{left:`${activeIndex*33.333}%`}}></div></div>
          </div>
        </div>

        {/* ---------- SPACER (Height adjusted to account for the new 2px margin) ---------- */}
        <div className={`content-spacer ${isScrolled?'collapsed':'expanded'}`}></div>

        {/* ---------- SCROLLABLE MESSAGE LIST (The main content that scrolls) ---------- */}
        <div className="message-list-scroll-container">
          {MessageData.map((data, index) => (
            <MessageItem key={index} {...data} />
          ))}
        </div>

        {/* ---------- Blank Pop-up Screen (FIXED – NO VISUAL DRAG) ---------- */}
        {showStoryViewer && (
          <div 
            className="story-viewer-overlay"
            onTouchStart={viewerTouchStart}
            onTouchMove={viewerTouchMove}
            onTouchEnd={viewerTouchEnd}
          >
            <div className="story-viewer-content"></div>
          </div>
        )}

        {/* ---------- Static Reply Bar – Instagram DM Style (FIXED) ---------- */}
        <div className={`story-reply-bar ${showStoryViewer?'':'hidden'}`}>
          <div className="story-reply-box">Reply privately...</div>
        </div>
      </div>
    );
  }

  const root = ReactDOM.createRoot(document.getElementById('root'));
  root.render(<NavigationBar />);
</script>
</body>
</html>

