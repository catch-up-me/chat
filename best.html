<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Chat Interface</title>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        html,body{height:100dvh;margin:0;padding:0;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
        #root{height:100dvh}
        [contentEditable=true]:empty:before{content:attr(placeholder);color:#9ca3af;pointer-events:none;opacity:.7}
        
        /* Prevent selection, copy, context menu, drag */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        [contentEditable=true] {
            -webkit-user-select: text;
            user-select: text;
        }
        img, video, a {
            pointer-events: none;
        }
        body {
            -webkit-context-menu: none;
            context-menu: none;
        }
        img {
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-drag: none;
        }
        * {
            -webkit-touch-callout: none;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useEffect, useRef, useState } = React;

        const ArrowLeft = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m12 19-7-7 7-7"/><path d="M19 12H5"/>
            </svg>
        );

        const MoreVertical = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/>
            </svg>
        );

        const MicrophoneIcon = () => (
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-6 h-6">
                <g id="SVGRepo_bgCarrier" strokeWidth="0"></g>
                <g id="SVGRepo_tracerCarrier" strokeLinecap="round" strokeLinejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                    <path d="M7.25 7C7.25 4.37665 9.37665 2.25 12 2.25C14.6234 2.25 16.75 4.37665 16.75 7V11C16.75 13.6234 14.6234 15.75 12 15.75C9.37665 15.75 7.25 13.6234 7.25 11V7Z" fill="#ffffff"></path>
                    <path d="M5.75 10C5.75 9.58579 5.41421 9.25 5 9.25C4.58579 9.25 4.25 9.58579 4.25 10V11C4.25 15.0272 7.3217 18.3369 11.25 18.7142V21C11.25 21.4142 11.5858 21.75 12 21.75C12.4142 21.75 12.75 21.4142 12.75 21V18.7142C16.6783 18.3369 19.75 15.0272 19.75 11V10C19.75 9.58579 19.4142 9.25 19 9.25C18.5858 9.25 18.25 9.58579 18.25 10V11C18.25 14.4518 15.4518 17.25 12 17.25C8.54822 17.25 5.75 14.4518 5.75 11V10Z" fill="#ffffff"></path>
                </g>
            </svg>
        );

        function ChatHeader({ stickyDate }) {
            return (
                <div className="fixed top-0 left-0 right-0 bg-white shadow-sm z-50 pt-[env(safe-area-inset-top)]">
                    <div className="flex items-center justify-between px-3 py-2">
                        <button className="p-2 hover:bg-gray-100 rounded-full transition-colors"><ArrowLeft/></button>
                        <div className="flex items-center flex-1 mx-3">
                            <div className="w-11 h-11 rounded-full bg-orange-400 flex items-center justify-center flex-shrink-0">
                                <span className="text-white font-medium text-base">DS</span>
                            </div>
                            <div className="ml-3 flex-1 min-w-0">
                                <h1 className="text-gray-900 font-medium text-base leading-tight">Daddy Steve</h1>
                                <p className="text-gray-500 text-sm leading-tight">last seen within a week</p>
                            </div>
                        </div>
                        <button className="p-2 hover:bg-gray-100 rounded-full transition-colors"><MoreVertical/></button>
                    </div>

                    <div className={`absolute left-1/2 transform -translate-x-1/2 transition-opacity duration-200 pointer-events-none ${stickyDate ? 'opacity-100' : 'opacity-0'}`}
                         style={{ bottom: '-32px' }}>
                        <div className="px-4 rounded-full flex items-center shadow-sm" style={{ 
                            backgroundColor: '#749cbf',
                            minHeight: '26px',
                            height: '26px'
                        }}>
                            <span className="text-white text-xs font-medium" style={{ lineHeight: '1' }}>{stickyDate || 'June 6'}</span>
                        </div>
                    </div>
                </div>
            );
        }

        function ChatLayout() {
            const scrollRef = useRef(null);
            const inputRef = useRef(null);
            const inputContainerRef = useRef(null);
            const bottomSheetRef = useRef(null);
            const [stickyDate, setStickyDate] = useState(null);
            const [isScrolling, setIsScrolling] = useState(false);
            const [showEmojiPicker, setShowEmojiPicker] = useState(false);
            let scrollTimeout = useRef(null);

            useEffect(() => {
                if (scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
            }, []);

            useEffect(() => {
                const input = inputRef.current;
                const container = inputContainerRef.current;
                const chat = scrollRef.current;

                if (!input || !container || !chat) return;

                const handleInput = () => {
                    input.style.height = 'auto';
                    const newHeight = Math.min(input.scrollHeight, 100);
                    input.style.height = `${newHeight}px`;
                    container.style.height = `${newHeight + 24}px`;
                    const bottomPadding = newHeight + 32 + (showEmojiPicker ? 280 : 0);
                    chat.style.paddingBottom = `${bottomPadding}px`;
                };

                input.addEventListener('input', handleInput);
                handleInput();

                return () => input.removeEventListener('input', handleInput);
            }, [showEmojiPicker]);

            useEffect(() => {
                const chat = scrollRef.current;
                if (!chat) return;

                const dateBadges = chat.querySelectorAll('.chat-date');
                const headerHeight = 80;
                let currentStickyDate = null;

                const checkStickyDate = () => {
                    setIsScrolling(true);
                    clearTimeout(scrollTimeout.current);

                    let newStickyDate = null;
                    dateBadges.forEach(badge => {
                        const rect = badge.getBoundingClientRect();
                        const badgeTop = rect.top;
                        if (badgeTop <= headerHeight + 10 && badgeTop + rect.height > headerHeight - 20) {
                            newStickyDate = badge.textContent.trim();
                        }
                    });

                    if (newStickyDate !== currentStickyDate) {
                        setStickyDate(newStickyDate);
                        currentStickyDate = newStickyDate;
                    }

                    scrollTimeout.current = setTimeout(() => {
                        setIsScrolling(false);
                        setStickyDate(null);
                    }, 800);
                };

                const handleScroll = () => {
                    checkStickyDate();
                };

                chat.addEventListener('scroll', handleScroll);
                return () => {
                    chat.removeEventListener('scroll', handleScroll);
                    clearTimeout(scrollTimeout.current);
                };
            }, []);

            const toggleEmojiPicker = () => {
                setShowEmojiPicker(prev => !prev);
            };

            const handleMouseDown = (e) => {
                e.preventDefault();
            };

            const handleChatClick = (e) => {
                e.preventDefault();
            };

            return (
                <div className="flex flex-col h-dvh bg-gray-50 relative">
                    <ChatHeader stickyDate={isScrolling ? stickyDate : null} />

                    <div ref={scrollRef}
                         onMouseDown={handleChatClick}
                         onTouchStart={handleChatClick}
                         className="flex-1 overflow-y-auto pt-20 px-4 transition-padding duration-300"
                         style={{
                             backgroundImage:'url(https://i.ibb.co/hxsGq3LC/Screenshot-20251105-115744.jpg)',
                             backgroundSize:'cover',
                             backgroundPosition:'center',
                             backgroundRepeat:'no-repeat',
                             paddingBottom: '64px',
                             transition: 'padding-bottom 300ms ease'
                         }}>
                        <div className="flex flex-col justify-end min-h-full space-y-4 py-4">
                            <div className="flex justify-center">
                                <div className="px-4 py-2 rounded-full flex items-center shadow-sm chat-date" style={{backgroundColor:'#749cbf',minHeight:'30px'}}>
                                    <span className="text-white text-xs font-medium" style={{lineHeight:'1'}}>June 16</span>
                                </div>
                            </div>

                            <div className="flex items-end gap-2"
                                 onMouseDown={handleMouseDown}
                                 onTouchStart={handleMouseDown}>
                                <div className="bg-white rounded-2xl rounded-bl-md px-4 py-2 shadow-sm max-w-xs">
                                    <div className="flex items-end gap-1">
                                        <span className="text-gray-900 text-base whitespace-nowrap">Bro</span>
                                        <span className="text-gray-400 text-xs ml-1">1:38 PM</span>
                                    </div>
                                </div>
                            </div>

                            <div className="flex items-end gap-2 justify-end"
                                 onMouseDown={handleMouseDown}
                                 onTouchStart={handleMouseDown}>
                                <div className="rounded-2xl rounded-br-md px-4 py-2 shadow-sm max-w-xs" style={{backgroundColor:'#5d7d99'}}>
                                    <div className="flex items-end gap-1">
                                        <span className="text-white text-base whitespace-nowrap">Hey</span>
                                        <div className="flex items-center gap-1 ml-1">
                                            <span className="text-blue-100 text-xs">1:39 PM</span>
                                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-4 h-4">
                                                <g clipPath="url(#clip0_949_23339)">
                                                    <path d="M17.5821 6.95711C17.9726 6.56658 17.9726 5.93342 17.5821 5.54289C17.1916 5.15237 16.5584 5.15237 16.1679 5.54289L5.54545 16.1653L1.70711 12.327C1.31658 11.9365 0.683417 11.9365 0.292893 12.327C-0.0976311 12.7175 -0.097631 13.3507 0.292893 13.7412L4.83835 18.2866C5.22887 18.6772 5.86204 18.6772 6.25256 18.2866L17.5821 6.95711Z" fill="#9ebad2"/>
                                                    <path d="M23.5821 6.95711C23.9726 6.56658 23.9726 5.93342 23.5821 5.54289C23.1915 5.15237 22.5584 5.15237 22.1678 5.54289L10.8383 16.8724C10.4478 17.263 10.4478 17.8961 10.8383 18.2866C11.2288 18.6772 11.862 18.6772 12.2525 18.2866L23.5821 6.95711Z" fill="#9ebad2"/>
                                                </g>
                                                <defs><clipPath id="clip0_949_23339"><rect width="24" height="24" fill="white"/></clipPath></defs>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Bottom Input + Emoji Picker */}
                    <div className="fixed bottom-0 left-0 right-0 z-40 pb-[env(safe-area-inset-bottom)] transition-transform duration-300"
                         style={{
                             backgroundImage:'url(https://i.ibb.co/hxsGq3LC/Screenshot-20251105-115744.jpg)',
                             backgroundSize:'cover',
                             backgroundPosition:'center',
                             backgroundRepeat:'no-repeat',
                             paddingTop:'8px',
                             paddingBottom:'8px',
                             transform: showEmojiPicker ? 'translateY(-280px)' : 'translateY(0)',
                         }}>
                        <div className="mx-3 flex items-center gap-2">
                            <div ref={inputContainerRef}
                                 className="bg-white shadow-sm flex items-center px-3 py-3 transition-all duration-100 flex-1"
                                 style={{
                                     borderRadius:'13px',
                                     minHeight:'48px',
                                     height:'48px',
                                     overflow:'hidden'
                                 }}>
                                <button 
                                    className="text-gray-400 hover:text-gray-600 transition-colors flex-shrink-0 mr-3"
                                    onMouseDown={handleMouseDown}
                                    onTouchStart={handleMouseDown}
                                    onClick={toggleEmojiPicker}>
                                    <i className="fa-regular fa-face-smile text-2xl"></i>
                                </button>
                                <div ref={inputRef}
                                     contentEditable="true"
                                     placeholder="Message"
                                     className="flex-1 outline-none text-gray-900 text-base"
                                     style={{
                                         minHeight:'24px',
                                         maxHeight:'100px',
                                         overflowY:'auto',
                                         resize:'none',
                                         lineHeight:'1.5'
                                     }}>
                                </div>
                                <button className="text-gray-400 hover:text-gray-600 transition-colors flex-shrink-0 ml-3"
                                        onMouseDown={handleMouseDown}
                                        onTouchStart={handleMouseDown}>
                                    <i className="fa-solid fa-paperclip text-2xl"></i>
                                </button>
                            </div>
                            <button className="w-12 h-12 flex-shrink-0 flex items-center justify-center shadow-sm transition-colors rounded-full" 
                                    onMouseDown={handleMouseDown}
                                    onTouchStart={handleMouseDown}
                                    style={{
                                        backgroundColor:'#749cbf'
                                    }}>
                                <MicrophoneIcon />
                            </button>
                        </div>
                    </div>

                    {/* Emoji Picker Bottom Sheet */}
                    <div 
                        ref={bottomSheetRef}
                        className={`fixed bottom-0 left-0 right-0 bg-white z-30 transition-transform duration-300 ease-out ${
                            showEmojiPicker ? 'translate-y-0' : 'translate-y-full'
                        }`}
                        style={{
                            height: '280px',
                            boxShadow: '0 -2px 10px rgba(0,0,0,0.1)',
                            backgroundImage: 'url(https://i.ibb.co/hxsGq3LC/Screenshot-20251105-115744.jpg)',
                            backgroundSize: 'cover',
                            backgroundPosition: 'center',
                            backgroundRepeat: 'no-repeat',
                        }}>
                        <div className="h-full flex items-center justify-center text-gray-400 text-sm">
                            {/* Empty space as requested */}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ChatLayout/>);
    </script>
</body>
</html>
